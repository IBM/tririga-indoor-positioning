<link rel="import" href="../triplat-view-behavior/triplat-view-behavior.html">
<link rel="import" href="../triblock-app-layout/triblock-app-layout.html">
<link rel="import" href="../triplat-routing/triplat-routing.html">

<link rel="import" href="../iron-pages/iron-pages.html">
<link rel="import" href="../google-chart/google-chart.html">
<link rel="import" href="../google-map/google-map.html">
<link rel="import" href="../iron-ajax/iron-ajax.html">
<link rel="import" href="../paper-item/paper-item.html">
<link rel="import" href="../paper-badge/paper-badge.html">
<link rel="import" href="../paper-checkbox/paper-checkbox.html">


<link rel="import" href="../paper-listbox/paper-listbox.html">
<link rel="import" href="../triplat-ds/triplat-ds.html">
<link rel="import" href="../triblock-table/triblock-table.html">
<link rel="import" href="../triblock-table-column/triblock-table-column.html">
<link rel="import" href="../triplat-calendar-container/triplat-calendar-container.html">
<link rel="import" href="../triplat-date-picker/triplat-date-picker.html">
<link rel="import" href="../triplat-datetime-picker/triplat-datetime-picker.html">
<link rel="import" href="../triplat-select-input/triplat-select-input.html">
<link rel="import" href="../triplat-graphic/triplat-graphic.html">
<link rel="import" href="../triplat-note/triplat-note.html">
<link rel="import" href="../triblock-scroll-container/triblock-scroll-container.html">
<link rel="import" href="../iron-dropdown/iron-dropdown.html">
<link rel="import" href="../iron-collapse/iron-collapse.html">
<link rel="import" href="../paper-menu/paper-menu.html">
<link rel="import" href="../paper-card/paper-card.html">
<link rel="import" href="../paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../triplat-title/triplat-title.html">
<link rel="import" href="../iron-image/iron-image.html">


<link rel="import" href="../triplat-graphic/triplat-graphic.html">

<script src="/tririga/p/components/r/en-US/l/webcomponentsjs/webcomponents-lite.js"></script>

<!-- <link rel="stylesheet" href="./leaflet.css" />
<script src="./leaflet.js"></script> -->

<!-- Mapping  -->
<!-- <script type="text/javascript" src="http://acba8347.ngrok.io/webcomponents-lite.js"></script> --> -->

<!-- <link rel="import" href="leaflet-map.html">
<link rel="import" href="leaflet-marker.html"> -->

<!-- <script type="text/javascript" src="webcomponents-lite.min.js"></script> -->
<!-- Mapping end -->

<link rel="import" href="tut-occupancy-styles.html">

<!-- Mapping end -->
<!-- <script type="text/javascript" src="./webcomponents-lite.min.js"></script> -->
<!-- <script src="//cdnjs.cloudflare.com/ajax/libs/polymer/0.3.2/platform.js"></script> -->
<!-- <link rel="import" href="leaflet-map.html"> -->

<dom-module id="tut-occupancy">
	<template>
		<style include="tut-occupancy-styles">
		</style>

		<style>
			triplat-graphic {
				height:350px;
				width:350px;
				display: block;
			}
		</style>

		<triplat-route id="homeRoute" name="home" path="/"></triplat-route>
		<!-- <triplat-route id="reportsRoute" name="reports" path="/reports"></triplat-route> -->
		<triplat-route id="buildingRoute" name="buildingdetails" path="/building"></triplat-route>
		<triplat-route id="watsonRoute" name="watson" path="/watson"></triplat-route>

		<triblock-app-layout
			app-label="Building Insights Dashboard"
			mobile-page-label="Building Insights Dashboard"
			show-mobile-back-button>

			<!-- Enable to customize app-title -->
			<div app-title>
				<span><b>App tut-occupancy</b></span>
			</div>

			<!-- <paper-item value$="{{ajaxBuildings.id}}">{{index}} - {{item.id}} - {{item.name}}</paper-item> -->
			<!-- <paper-listbox multi>
				<paper-item value="{{ajaxBuildings}}"</paper-item>
			<paper-listbox> -->
			<paper-checkbox checked> Mock Data</paper-checkbox>

			<triblock-banner-button tap-handler="_navigateToHome" home></triblock-banner-button>
			<triblock-banner-button tap-handler="_navigateBack" back></triblock-banner-button>
			<triblock-banner-button icon="ibm:table-tables" label="Details" triplat-route-id="buildingRoute"></triblock-banner-button>

			<!-- <triblock-banner-button icon="ibm:table-tables" label="Reports" triplat-route-id="reportsRoute"></triblock-banner-button> -->
			<triblock-banner-button icon="ibm:world-globe" label="Watson Analytics" triplat-route-id="watsonRoute"></triblock-banner-button>

			<triplat-route-selector content>
				<iron-pages>
					<section route="home" default-route>
						<!-- <triplat-title title-label="Space Assessment"></triplat-title> -->
						<div>
						  <!-- <span><triplat-title title-label="Space Assessment"></triplat-title></span> -->
							<span><p> Building Insights Dashboard </p></span>
							<!-- <triplat-graphic record-id="{{floor._id}}"></triplat-graphic> -->

							 <paper-listbox selected="0" style="width:920">
								 <paper-item> North America - Atlanta Office</paper-item>
							   <paper-item> 02-Second Floor</paper-item>
							 </paper-listbox>

							<!-- <paper-menu>
							  <paper-item>Item 1</paper-item>
							  <paper-item>Item 2</paper-item>
							</paper-menu> -->
							</br>

							<span>
								<!-- <p>drawingidloading "{{drawingIdLoading}}"</p> -->
								<!-- <p>hasgraphic "{{hasGraphic}}"</p> -->
								<triplat-graphic record-id="1000291" drawing-id-loading="{{drawingIdLoading}}" has-graphic="{{hasGraphic}}">></triplat-graphic>
								<!-- <triplat-graphic drawing-id=14006564></triplat-graphic> -->
							</span>

							<span>
								<p> Hourly Weather Prediction </p>
								<!-- <p>"{{weatherData}}"</p> -->
								<template is="dom-repeat" items="{{weatherData}}">
									<!-- <p>"{{item.temp}}F {{item.dow}} {{item.phrase_12char}} {{item.fcst_valid_local}}</p> -->
									<paper-card style="float:left" heading="{{item.temp}} FÂ°">
										<div class="card-content">{{item.fcst_valid_local}}</div>
										<!-- <div class="card-content">"{{ajaxLineData}}"</div> -->
										<!-- <div class="card-content">{{item.temp}}F</div> -->
										<!-- <div class="card-content">UV Index: {{item.uv_index_raw}}</div> -->
										<div class="card-content">{{item.phrase_32char}}</div>
										<!-- <div class="card-content">{{item.dow}}</div> -->
										<!-- <div class="card-actions">
											<paper-button>Some action</paper-button>
										</div> -->
									</paper-card>
								</template>
							</span>

							<span>
							 <!-- <triplat-ds id="people" name="people" data="{{people}}"></triplat-ds> -->
							 <!-- <triplat-ds id="triAppPeopleSearch" name="triAppPeopleSearch" data="{{triAppPeopleSearch}}"></triplat-ds> -->
							 <!-- <triplat-ds id="triPeople" name="triPeople" data="{{triPeople}}"></triplat-ds> -->
							 <triplat-ds id="occupancy" name="occupancy" data="{{triOccupancy}}"></triplat-ds>
							 <triplat-ds id="space" name="space" data="{{triSpace}}"></triplat-ds>
							</span>

							<!-- <span>
							 <triplat-graphic drawing-id="1026"></triplat-graphic>
  						</span> -->
							<div>
							<!-- TODO, use redraw -->
							<!-- "vAxis": {"minValue" : 0, "maxValue": 8}} -->

							<!-- options='{"title": "Estate Occupancy (24hr)", "hAxis": {"format": "Q#", "ticks": [1, 2, 3, 4], "viewWindow": {"min": 0.5,"max": 4.5}}}' -->
							<!-- options='{ "chm":"H,FF0000,0,18,1", "title": "Estate Occupancy (24hr)", "hAxis": {"format": "Q#", "ticks": [1, 2, 3, 4], "viewWindow": {"min": 0.5,"max": 4.5}}}' -->
							<google-chart
								style="width:100%; height:400px;"
							  type='line'
							  options='{"title": "Estate Occupancy (24hr)", "series": {"0": { "lineDashStyle": [1, 1] }}}'

								data="{{ajaxLineData}}"
							</google-chart>
							</div>

							<br>
							<br>
							<span>
								<!-- <leaflet-map> </leaflet-map> -->
							<!-- TODO, table should reflect mutiple columns; building id, occupancy, percentage, prediction -->
							<!-- TODO, add last update  -->
							<triblock-table id="table1"  title="Occupancy Stats" data="{{ajaxSampleTable}}" style="width:100%; height:500px;">
								    <triblock-table-column title="Building" property="id"></triblock-table-column>
										<triblock-table-column title="Occupancy" property="Occupancy"></triblock-table-column>
										<triblock-table-column title="Percentage" property="Percentage"></triblock-table-column>
										<triblock-table-column title="Prediction (Next hour)" property="Prediction"></triblock-table-column>
							</triblock-table>


							<!-- <triblock-table id="tablePeople"  title="Occupancy Stats" data="{{triPeople}}" style="width:100%; height:500px;">
								    <triblock-table-column title="First Name" property="triNameTX"></triblock-table-column>
										<triblock-table-column title="Last Name" property="triLastNameTX"></triblock-table-column>
										<triblock-table-column title="Role" property="triFunctionalRoleCL"></triblock-table-column>
										<triblock-table-column title="Location" property="triPathTX"></triblock-table-column>
							</triblock-table> -->
							<triblock-table id="tableSpace"  title="Space" data="{{triSpace}}" style="width:100%; height:500px;">
										<triblock-table-column title="space" property="roomName"></triblock-table-column>
										<triblock-table-column title="image" property="image">

										</triblock-table-column>
							</triblock-table>




							</span>

							<span>
								<!-- <leaflet-map> </leaflet-map> -->
							<!-- TODO, table should reflect mutiple columns; building id, occupancy, percentage, prediction -->
							<!-- TODO, add last update  -->
							<br>
							<br>
							<br>
							<triblock-table id="table1"  title="Tririga Occupancy Stats" data="{{triOccupancy}}" style="width:100%; height:500px;">
								    <triblock-table-column title="Building" property="buildingID"></triblock-table-column>
										<triblock-table-column title="Occupancy" property="headcount"></triblock-table-column>
										<triblock-table-column title="Usage" property="use"></triblock-table-column>
							</triblock-table>

							</span>

							<br>
							<div>
								<span>
								<google-chart
   								style="width:100%; height:400px;"
								  type='column'
								  options='{"title": "Building Occupancy vs Energy Consumption (24hr)"}'
									data="{{ajaxOEData}}"
								</google-chart>
								</span>
								<span>
								<google-chart
								  type='pie'
								  options='{"title": "Buildings by Occupancy"}'
									data="{{ajaxData}}"
								</google-chart>
								</span>

							</div>
							<br>
							<br>
							<br>
							<br>
							<!-- <div style="float:left">
							<span>
								<google-chart
								  type='column'
								  options='{"title": "Sample Detailed Occupancy"}'
									data="{{ajaxSampleOccupancy}}"
								</google-chart>
							</span>
							</div> -->


							<span>
								<iron-dropdown horizontal-align="right" vertical-align="top">
								  <div class="dropdown-content">Hello!</div>
								</iron-dropdown>
							</span>

							<!-- <button on-click="toggle">toggle collapse</button>
							<iron-collapse id="collapse">
							  <div>Content goes here...</div>
							</iron-collapse> -->

							<!-- <span>
							<triblock-table id="table1"  data="{{ajaxBuildings}}" style="width:80%">
								    <triblock-table-column title="Building ID" property="id"></triblock-table-column>
							</triblock-table>
							</span> -->

							<!-- generate key, add weather -->
							<!-- http://${TRIRIGA_IP}:8001/tririga/p/web/doc#!/triplat-weather/ -->
							<!-- Where's the "TRIRIGAWEB.properties file", need to set the WEATHER_API_KEY property -->
							<!-- </span> -->
							<!-- <p>map</p> -->
						</div>


						<!-- <google-map latitude="37.77493" longitude="-122.41942" fit-to-markers>
						 <google-map-marker latitude="37.779" longitude="-122.3892"
								 draggable="true" title="Go Giants!"></google-map-marker>
						 <google-map-marker latitude="37.777" longitude="-122.38911"></google-map-marker>
					 </google-map> -->


						<iron-ajax auto url="http://17eb7a89.ngrok.io/weather" handle-as="json" last-response="{{weatherData}}"></iron-ajax>

						<iron-ajax auto url="http://17eb7a89.ngrok.io/sample/pie" handle-as="json" last-response="{{ajaxData}}"></iron-ajax>
						<iron-ajax auto url="http://17eb7a89.ngrok.io/sample/oe" handle-as="json" last-response="{{ajaxOEData}}"></iron-ajax>
						<iron-ajax auto url="http://17eb7a89.ngrok.io/sample/line" handle-as="json" last-response="{{ajaxLineData}}"></iron-ajax>
						<iron-ajax auto url="http://17eb7a89.ngrok.io/buildings" handle-as="json" last-response="{{ajaxBuildings}}"></iron-ajax>
						<iron-ajax auto url="http://17eb7a89.ngrok.io/sample/occupancy" handle-as="json" last-response="{{ajaxSampleOccupancy}}"></iron-ajax>
						<iron-ajax auto url="http://17eb7a89.ngrok.io/sample/table" handle-as="json" last-response="{{ajaxSampleTable}}"></iron-ajax>
						<iron-ajax auto url="http://17eb7a89.ngrok.io/sample/detailed" handle-as="json" last-response="{{ajaxSingleBuilding}}"></iron-ajax>
						<iron-ajax auto url="http://17eb7a89.ngrok.io/buildings/coords" handle-as="json" last-response="{{buildingCoords}}"></iron-ajax>
						<iron-ajax auto url="http://17eb7a89.ngrok.io/occupancy" handle-as="json" last-response="{{occupancy}}"></iron-ajax>


					</section>
					<section route="detailed">
						<span>Detailed View</span>
						<span>
						<!-- TODO, table should reflect mutiple columns; building id, occupancy, percentage, prediction -->
						<!-- TODO, add last update  -->
						<!-- Each row is a different floor -->
						<span>
						<paper-card heading="Last Updated">
							<!-- <div class="card-content">"{{ajaxLineData}}"</div> -->
							<div class="card-content">2019-01-20T00:00:00.000+0000</div>
							<div id="map" ></div>
						  <div class="card-content">{{buildings[0]}}</div>
							<!-- <div class="card-actions">
								<paper-button>Some action</paper-button>
							</div> -->
						</paper-card>
						</span>
						<triblock-table id="detailedtable"  title="Occupancy Stats" data="{{ajaxSampleTable}}" style="width:100%; height:250px;">
									<triblock-table-column title="Building" property="id"></triblock-table-column>
									<triblock-table-column title="Occupancy" property="Occupancy"></triblock-table-column>
									<triblock-table-column title="Percentage" property="Percentage"></triblock-table-column>
									<triblock-table-column title="Prediction (Next hour)" property="Prediction"></triblock-table-column>
						</triblock-table>


						<!-- TODO, add line graph? -->
						</span>
						<!-- <span>
							<iframe scrolling="no" width="100%" height="100%" margin-top="100px" title="Cyclist Danger Zones"
src="http://orcommunitycolleges.maps.arcgis.com/apps/webappviewer/index.html?id=f4c8ec20ff7d462dbc66e207cb1f2cfc"></iframe>

						</span> -->
						<!-- <iron-ajax auto url="http://fe1c7f46.ngrok.io/getsampledata" handle-as="json" last-response="{{ajaxData}}"></iron-ajax>
						<iron-ajax auto url="http://fe1c7f46.ngrok.io/getsamplelinedata" handle-as="json" last-response="{{ajaxLineData}}"></iron-ajax>
						<iron-ajax auto url="http://fe1c7f46.ngrok.io/getbuildings" handle-as="json" last-response="{{ajaxBuildings}}"></iron-ajax>
						<iron-ajax auto url="http://fe1c7f46.ngrok.io/getsampleoccupancy" handle-as="json" last-response="{{ajaxSampleOccupancy}}"></iron-ajax>
						<iron-ajax auto url="http://fe1c7f46.ngrok.io/getsampletabledata" handle-as="json" last-response="{{ajaxSampleTable}}"></iron-ajax> -->
					</section>
					<section route="buildingdetails">
						<span>Building Details Page</span>
						<span>
						<paper-dropdown-menu label="Select Building" style="width:40%" on-iron-select="_itemSelected">  <!-- vertical-align> -->
							<paper-listbox attr-for-selected="id" class="dropdown-content" fallback-selection="default" selected="{{selected}}">
								<template is="dom-repeat" items="{{ajaxBuildings}}">
									<paper-item id="{{item.id}}">{{item.id}}</paper-item>
								</template>
							</paper-listbox>
						</paper-dropdown-menu>

						<iron-ajax auto url="http://17eb7a89.ngrok.io/cache.json" handle-as="json" last-response="{{cache}}"></iron-ajax>
						<iron-ajax auto url="http://17eb7a89.ngrok.io/cachepriorities" handle-as="json" last-response="{{cachePriorities}}"></iron-ajax>
						<iron-ajax auto url="http://17eb7a89.ngrok.io/buildings" handle-as="json" last-response="{{ajaxBuildings}}"></iron-ajax>
						<iron-ajax auto url="http://17eb7a89.ngrok.io/cardtest" handle-as="json" last-response="{{cardTestData}}"></iron-ajax>

						<!-- <span> -->
						<!-- TODO, use array selector? -->
					  <triplat-datetime-picker style="width:40%" value="{{value}}">
							<!-- <iron-icon label icon="av:play-arrow"></iron-icon> -->
							<span label>Select Time & Date</span>
						</triplat-datetime-picker>
						</span>

						<!-- <span>
						<template is="dom-repeat" items="{{buildings}}">
						  <div>[[item.id]]</div>
						</template>
						</span> -->
						<span>
							<!-- <span>foobar bind</span>
							<template is="dom-repeat" items="{{ajaxBuildings}}">
								<paper-item id="{{item.id}}">{{item.id}}</paper-item>
								<div> "{{item.id}}"</div>
							</template> -->
							<!-- <template is="dom-repeat" items="{{cache.payload['/v1/building/allpriorities/B052']['rows']}}"> -->

							<!-- <template is="dom-repeat" items="{{cachePriorities}}">
								<div class="card-content">{{item}}</div>
							</template> -->

						<template id="buildingSelect" is="dom-repeat" items="{{cardTestData}}">
							<template is="dom-if" if="[[matchID(item.id, selectedBuilding)]]">
								<div>
								<!-- <template id="t" is="dom-bind"> -->
									<!-- <span>"{{cache.payload['/v1/building/unusual/usage/top/B052']}}"</span> -->
									<span>"{{cache.payload}}"</span>
								<!-- </template> -->

								<paper-card style="width:40%" heading="{{item.id}}">
									<div class="card-content">{{item.updatetime}}</div>
									<div class="card-content">{{item.temp}}</div>
									<div class="card-content">{{item.estate}}</div>

								</paper-card>
								<google-map id="map" style="height:20em;width:50%;float:right" api-key="AIzaSyBmrSeMuKFVTu8pn6mdjxnVyHgfkJbz_UQ" latitude="37.77493" longitude="-122.41942" fit-to-markers><!-- gitignore -->
								  <!-- <google-map-marker latitude="37.779" longitude="-122.3892"
								      draggable="true" title="Go Giants!"></google-map-marker>
								  <google-map-marker latitude="37.777" longitude="-122.38911"></google-map-marker> -->
									<!-- <template is="dom-repeat" items='[{"latitude":41.65987117,"longitude":-73.9389003,"title":"B707"},{"latitude":41.65102,"longitude":-73.93259,"title":"B705"},{"latitude":41.655684,"longitude":-73.937963,"title":"B706"},{"latitude":41.65607742,"longitude":-73.93965132,"title":"B052"},{"latitude":41.657238,"longitude":-73.935661,"title":"B008"},{"latitude":12.95226468,"longitude":77.64390053,"title":"EGLC"},{"latitude":12.95155368,"longitude":77.64324653,"title":"EGLD"}]'> -->
									<!-- <template is="dom-repeat" items='{{buildingCoords}}'> -->
										<google-map-marker latitude="{{item.coords.latitude}}" longitude="{{item.coords.longitude}}" title="{{item.title}}"></google-map-marker>
									<!-- </template> -->

								</google-map>
								<div>
									<triblock-table id="tablebuilding"  title="Building Detailed" data="{{ajaxSingleBuilding}}" style="width:100%; height:500px;">
												<triblock-table-column title="Floor" property="id"></triblock-table-column>
												<triblock-table-column title="Occupancy" property="Occupancy"></triblock-table-column>
												<triblock-table-column title="Percentage" property="Percentage"></triblock-table-column>
												<triblock-table-column title="Prediction (Next hour)" property="Prediction"></triblock-table-column>
									</triblock-table>
								</div>
								</div>
							</template>
						</template>



						<!-- </span>
						<triblock-table id="detailedtable"  title="Occupancy Stats" data="{{ajaxSampleTable}}" style="width:100%; height:250px;">
									<triblock-table-column title="Building" property="id"></triblock-table-column>
									<triblock-table-column title="Occupancy" property="Occupancy"></triblock-table-column>
									<triblock-table-column title="Percentage" property="Percentage"></triblock-table-column>
									<triblock-table-column title="Prediction (Next hour)" property="Prediction"></triblock-table-column>
						</triblock-table>
						</span> -->


					</section>


					<section route="watson">
						<span>Watson Analytics Page</span>
					</section>
				</iron-pages>
			</triplat-route-selector>
<!-- TODO, add link to locate app at /tririga/p/web/locate#!/room/-1 -->
		</triblock-app-layout>

	</template>
</dom-module>
<script defer>
	// var map = L.map("map").setView([37.75, -122.23], 10);
	// L.esri.basemapLayer("Topographic").addTo(map);
	// setTimeout(function(){
	// 	 console.log("drawing map")
	// 	 map = L.map('map').setView([51.505, -0.09], 13);
	// 	 // L.esri.basemapLayer("Topographic").addTo(map)
	// }, 3000);
</script>
<script>

	// var mymap = L.map('mapid').setView([51.505, -0.09], 13);

	Polymer({

		is: "tut-occupancy",

		behaviors: [TriPlatViewBehavior],

		_navigateToHome: function() {
			this.$.homeRoute.navigate();
		},

		_navigateBack: function() {
			window.history.back();
		},

		properties: {
				headers: {
						type: Object,
						value: function() { return {}; }
				},
				user: String,
				pass: String,
				selected: {
						type: String,
						notify: true
				}
				// recordId: "1016980"
		},

		// this.recordId: "1016980",

		matchID: function(i, selected) {
				console.log("found match");
        return i === selected;
    },


		makeHeaders: function(user,pass){
				return "Basic " + window.btoa(user + ":" + pass);
		},

		_setBasicAuth: function(user, pass) {
        this.headers['X-Requested-With'] = "XMLHttpRequest";
	      this.headers['Authorization'] = this.makeHeaders(user, pass);
        this.$.xhr.generateRequest();
		},

		toggle: function() {
		  	this.$.collapse.toggle();
		},

		// TODO test and replace ngrok ips with this var
		// server: "ngrok / kubernetes ip + port"
		server: "http://17eb7a89.ngrok.io",

		_itemSelected : function(e) {
			var selectedItem = e.target.selectedItem;
			if (selectedItem) {
				console.log("selected: " + selectedItem.innerText);
			}
			this.selectedBuilding = selectedItem.innerText
		}

		// TODO, perhaps add this as a way to redraw element on change
		// onSelect: function() {
	      // Polymer.dom(this).querySelector('img').src = ...;
				//
	  // },

	});

	// marker = document.createElement('google-map-marker');
	// marker.longitude =  "37.789"
	// marker.latitude = "-122.3892"
	// marker.icon = 'ICON_UR'
	// document.querySelector('#map')
	// Polymer.dom(document.getElementById("map")).appendChild(marker);
	// document.getElementById("map").appendChild(marker);
	// Polymer.dom(this.$.map).appendChild(marker);
	// var card = document.getElementById("map")
	// card.innerHTML;
	// Polymer.dom(container).appendChild(card);
	// var newDiv = document.createElement('div');
	// setTimeout(function(){
	// 	 console.log("drawing map")
	// 	 map = L.map('map').setView([51.505, -0.09], 13);
	// 	 // L.esri.basemapLayer("Topographic").addTo(map)
	// }, 3000);
	// var div = document.getElementById("map")

	// Polymer.dom(this.root).appendChild(newDiv);

</script>
